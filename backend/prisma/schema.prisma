// =========================
// PRISMA SCHEMA: FRAUD DETECTION SYSTEM
// =========================

// ----------
// GENERATOR & DATASOURCE
// ----------
generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ----------
// ENUM: Status Batch Upload
// Digunakan untuk menandai status proses upload batch transaksi
// ----------
enum BatchStatus {
  PENDING
  COMPLETED
  FAILED
}

// ----------
// MODEL: UploadBatch
// Mencatat setiap sesi upload file transaksi oleh user
// ----------
model UploadBatch {
  id        String      @id @default(cuid())
  fileName  String
  status    BatchStatus @default(PENDING)
  createdAt DateTime    @default(now())

  // Relasi ke User (setiap batch dimiliki satu user)
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Relasi: Satu batch memiliki banyak transaksi
  transactions Transaction[]
}

// ----------
// MODEL: Transaction
// Menyimpan data transaksi asli dan hasil analisis anomali
// ----------
model Transaction {
  id        String   @id @default(cuid()) // ID unik transaksi
  amount    Float // Jumlah transaksi
  timestamp DateTime // Waktu transaksi
  merchant  String // Nama merchant/toko
  location  String // Lokasi transaksi

  // Informasi Anomali (opsional, hasil AI)
  isAnomaly    Boolean? @default(false) // Apakah ini anomali?
  anomalyScore Float? // Skor risiko dari model AI

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relasi ke UploadBatch
  UploadBatch   UploadBatch? @relation(fields: [uploadBatchId], references: [id])
  uploadBatchId String?

  // Penjelasan AI (opsional, hasil Gemini)
  aiExplanation String? @db.Text
}

// ----------
// MODEL: User
// Menyimpan data user aplikasi (termasuk Google OAuth)
// ----------
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  password  String
  googleId  String?  @unique // Optional field for Google authentication
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relasi: Satu user bisa punya banyak upload batch
  uploadBatches UploadBatch[]
}
